/**
 * ì‹í’ˆë“±ì˜ í‘œì‹œê¸°ì¤€ FOOD_TYPES ë°°ì—´ì„ ì¶”ì¶œí•´ì„œ Supabaseì— ì—…ë¡œë“œ
 */

const { createClient } = require('@supabase/supabase-js');
require('dotenv').config({ path: '.env.local' });

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY;
const supabase = createClient(supabaseUrl, supabaseKey);

// ì‹í’ˆë“±ì˜ í‘œì‹œê¸°ì¤€ì—ì„œ ì¶”ì¶œí•œ FOOD_TYPES ë°°ì—´ (ì™„ì „í•œ ëª©ë¡)
const FOOD_TYPES = [
  // ê³¼ìë¥˜, ë¹µë¥˜ ë˜ëŠ” ë–¡ë¥˜ (í‘œ 3)
  'ê³¼ìë¥˜',
  'ë¹µë¥˜', 
  'ë–¡ë¥˜',
  'ìº”ë””ë¥˜',
  'ì¶”ì‰ê»Œ',
  'í”¼ì',
  
  // ë¹™ê³¼ë¥˜
  'ì•„ì´ìŠ¤í¬ë¦¼ë¥˜',
  'ì•„ì´ìŠ¤í¬ë¦¼ë¯¹ìŠ¤ë¥˜',
  'ë¹™ê³¼',
  'ì–¼ìŒë¥˜',
  
  // ì½”ì½”ì•„ê°€ê³µí’ˆë¥˜ ë˜ëŠ” ì´ˆì½œë¦¿ë¥˜
  'ì½”ì½”ì•„ê°€ê³µí’ˆë¥˜',
  'ì´ˆì½œë¦¿ë¥˜',
  'ì´ˆì½œë¦¿ê°€ê³µí’ˆ',
  
  // ë‹¹ë¥˜
  'ì„¤íƒ•ë¥˜',
  'ë‹¹ì‹œëŸ½ë¥˜',
  'ì˜¬ë¦¬ê³ ë‹¹ë¥˜',
  'í¬ë„ë‹¹',
  'ê³¼ë‹¹ë¥˜',
  'ì—¿ë¥˜',
  'ë‹¹ë¥˜ê°€ê³µí’ˆ',
  'ì¼ë¥˜',
  
  // ë‘ë¶€ë¥˜ ë˜ëŠ” ë¬µë¥˜
  'ë‘ë¶€',
  'ìœ ë°”',
  'ê°€ê³µë‘ë¶€',
  'ë¬µë¥˜',
  
  // ì‹ìš©ìœ ì§€ë¥˜
  'ì‹ë¬¼ì„±ìœ ì§€ë¥˜',
  'ë™ë¬¼ì„±ìœ ì§€ë¥˜',
  'ì‹ìš©ìœ ì§€ê°€ê³µí’ˆ',
  'í˜¼í•©ì‹ìš©ìœ ',
  'í–¥ë¯¸ìœ ',
  'ê°€ê³µìœ ì§€',
  'ì‡¼íŠ¸ë‹',
  'ë§ˆê°€ë¦°',
  'ëª¨ì¡°ì¹˜ì¦ˆ',
  'ì‹ë¬¼ì„±í¬ë¦¼',
  
  // ë©´ë¥˜
  'ìƒë©´',
  'ìˆ™ë©´',
  'ê±´ë©´',
  'ë‹¹ë©´',
  'ìœ íƒ•ë©´',
  
  // ìŒë£Œë¥˜
  'ë‹¤ë¥˜',
  'ì¹¨ì¶œì°¨',
  'ì•¡ìƒì°¨',
  'ê³ í˜•ì°¨',
  'ì»¤í”¼',
  'ê³¼ì¼Â·ì±„ì†Œë¥˜ìŒë£Œ',
  'ë†ì¶•ê³¼Â·ì±„ì¦™',
  'ê³¼Â·ì±„ì£¼ìŠ¤',
  'ê³¼Â·ì±„ìŒë£Œ',
  'íƒ„ì‚°ìŒë£Œë¥˜',
  'íƒ„ì‚°ìŒë£Œ',
  'íƒ„ì‚°ìˆ˜',
  'ë‘ìœ ë¥˜',
  'ë°œíš¨ìŒë£Œë¥˜',
  'ì¸ì‚¼Â·í™ì‚¼ìŒë£Œ',
  'ê¸°íƒ€ìŒë£Œ',
  'í˜¼í•©ìŒë£Œ',
  'ìŒë£Œë² ì´ìŠ¤',
  
  // íŠ¹ìˆ˜ì˜ì–‘ì‹í’ˆ
  'ì¡°ì œìœ ë¥˜',
  'ì˜ì•„ìš© ì¡°ì œì‹',
  'ì„±ì¥ê¸°ìš© ì¡°ì œì‹',
  'ì˜Â·ìœ ì•„ìš© ì´ìœ ì‹',
  'íŠ¹ìˆ˜ì˜ë£Œìš©ë„ë“±ì‹í’ˆ',
  'ì²´ì¤‘ì¡°ì ˆìš©ì¡°ì œì‹í’ˆ',
  'ì„ì‚°Â·ìˆ˜ìœ ë¶€ìš©ì‹í’ˆ',
  
  // íŠ¹ìˆ˜ì˜ë£Œìš©ë„ì‹í’ˆ
  'í‘œì¤€í˜•ì˜ì–‘ì¡°ì œì‹í’ˆ',
  'ì¼ë°˜í™˜ììš©ê· í˜•ì˜ì–‘ì¡°ì œì‹í’ˆ',
  'ë‹¹ë‡¨í™˜ììš©ì˜ì–‘ì¡°ì œì‹í’ˆ',
  'ì‹ ì¥ì§ˆí™˜ììš©ì˜ì–‘ì¡°ì œì‹í’ˆ',
  'ì¥ì§ˆí™˜ììš©ë‹¨ë°±ê°€ìˆ˜ë¶„í•´ì˜ì–‘ì¡°ì œì‹í’ˆ',
  'ì—´ëŸ‰ë°ì˜ì–‘ê³µê¸‰ìš©ì‹í’ˆ',
  'ì—°í•˜ê³¤ë€ììš©ì ë„ì¡°ì ˆì‹í’ˆ',
  'ë§ì¶¤í˜•ì˜ì–‘ì¡°ì œì‹í’ˆ',
  'ì„ ì²œì„±ëŒ€ì‚¬ì§ˆí™˜ììš©ì¡°ì œì‹í’ˆ',
  'ì˜Â·ìœ ì•„ìš©íŠ¹ìˆ˜ì¡°ì œì‹í’ˆ',
  'ê¸°íƒ€í™˜ììš©ì˜ì–‘ì¡°ì œì‹í’ˆ',
  'ì‹ë‹¨í˜•ì‹ì‚¬ê´€ë¦¬ì‹í’ˆ',
  'ë‹¹ë‡¨í™˜ììš©ì‹ë‹¨í˜•ì‹í’ˆ',
  'ì‹ ì¥ì§ˆí™˜ììš©ì‹ë‹¨í˜•ì‹í’ˆ',
  
  // ì¥ë¥˜
  'ë©”ì£¼',
  'í•œì‹ê°„ì¥',
  'ì–‘ì¡°ê°„ì¥',
  'ì‚°ë¶„í•´ê°„ì¥',
  'íš¨ì†Œë¶„í•´ê°„ì¥',
  'í˜¼í•©ê°„ì¥',
  'í•œì‹ëœì¥',
  'ëœì¥',
  'ê³ ì¶”ì¥',
  'ì¶˜ì¥',
  'ì²­êµ­ì¥',
  'ë‚˜í† ',
  'í˜¼í•©ì¥',
  'ê¸°íƒ€ì¥ë¥˜',
  
  // ì¡°ë¯¸ì‹í’ˆ
  'ì‹ì´ˆ',
  'ì†ŒìŠ¤ë¥˜',
  'ì†ŒìŠ¤',
  'ë“œë ˆì‹±',
  'ë®ë°¥ì†ŒìŠ¤',
  'ë§ˆìš”ë„¤ì¦ˆ',
  'í† ë§ˆí† ì¼€ì²©',
  'ë³µí•©ì¡°ë¯¸ì‹í’ˆ',
  'ì¹´ë ˆ(ì»¤ë¦¬)',
  'ë ˆí† ë¥´íŠ¸ì‹í’ˆ',
  'ê³ ì¶§ê°€ë£¨',
  'ì‹¤ê³ ì¶”',
  'í–¥ì‹ ë£Œê°€ê³µí’ˆ',
  'ì‹ì—¼',
  
  // ì ˆì„ë¥˜ ë˜ëŠ” ì¡°ë¦¼ë¥˜
  'ê¹€ì¹˜ë¥˜',
  'ê¹€ì¹«ì†',
  'ê¹€ì¹˜',
  'ë°°ì¶”ê¹€ì¹˜',
  'ë¬¼ê¹€ì¹˜',
  'ê¸°íƒ€ê¹€ì¹˜',
  'ì ˆì„ë¥˜',
  'ì ˆì„ì‹í’ˆ',
  'ì¥ì•„ì°Œ',
  'ë‹¹ì ˆì„',
  'ì¡°ë¦¼ë¥˜',
  
  // ì£¼ë¥˜
  'ë°œíš¨ì£¼ë¥˜',
  'ì¦ë¥˜ì£¼ë¥˜',
  'ê¸°íƒ€ì£¼ë¥˜',
  'ì£¼ì •',
  
  // ë†ì‚°ê°€ê³µì‹í’ˆë¥˜
  'ì „ë¶„ë¥˜',
  'ë°€ê°€ë£¨ë¥˜',
  'ë•…ì½©ë˜ëŠ”ê²¬ê³¼ë¥˜ê°€ê³µí’ˆë¥˜',
  'ë•…ì½©ë²„í„°',
  'ë•…ì½©ë˜ëŠ”ê²¬ê³¼ë¥˜ê°€ê³µí’ˆ',
  'ì‹œë¦¬ì–¼ë¥˜',
  'ì°ìŒ€',
  'íš¨ì†Œì‹í’ˆ',
  'ê¸°íƒ€ë†ì‚°ê°€ê³µí’ˆë¥˜',
  'ê³¼Â·ì±„ê°€ê³µí’ˆ',
  'ê±´ê³¼ë¥˜',
  'ê³¡ë¥˜ê°€ê³µí’ˆ',
  'ëˆ„ë£½ì§€',
  'ì„œë¥˜ê°€ê³µí’ˆ',
  'ê°ìíŠ€ê¹€',
  
  // ì‹ìœ¡ê°€ê³µí’ˆ ë° í¬ì¥ìœ¡
  'í–„ë¥˜',
  'í–„',
  'í”„ë ˆìŠ¤í–„',
  'ì†Œì‹œì§€ë¥˜',
  'ì†Œì‹œì§€',
  'ë°œíš¨ì†Œì‹œì§€',
  'í˜¼í•©ì†Œì‹œì§€',
  'ë² ì´ì»¨ë¥˜',
  'ê±´ì¡°ì €ì¥ìœ¡ë¥˜',
  'ì–‘ë…ìœ¡ë¥˜',
  'ì–‘ë…ìœ¡',
  'ë¶„ì‡„ê°€ê³µìœ¡ì œí’ˆ',
  'ê°ˆë¹„ê°€ê³µí’ˆ',
  'ì‹ìœ¡ì¶”ì¶œê°€ê³µí’ˆ',
  'ì‹ìœ¡í•¨ìœ ê°€ê³µí’ˆ',
  'ìœ¡í¬ë“±ìœ¡ë¥˜ë§ë¦°ê²ƒ',
  'í¬ì¥ìœ¡',
  
  // ì•Œê°€ê³µí’ˆë¥˜
  'ì•Œê°€ê³µí’ˆ',
  'ì•Œí•¨ìœ ê°€ê³µí’ˆ',
  
  // ìœ ê°€ê³µí’ˆ
  'ìš°ìœ ë¥˜',
  'ìš°ìœ ',
  'í™˜ì›ìœ ',
  'ê°€ê³µìœ ë¥˜',
  'ê°•í™”ìš°ìœ ',
  'ìœ ì‚°ê· ì²¨ê°€ìš°ìœ ',
  'ìœ ë‹¹ë¶„í•´ìš°ìœ ',
  'ê°€ê³µìœ ',
  'ì‚°ì–‘ìœ ',
  'ë°œíš¨ìœ ',
  'ë°œíš¨ìœ ë¶„ë§',
  'ë²„í„°ìœ ',
  'ë†ì¶•ìœ ë¥˜',
  'ìœ í¬ë¦¼ë¥˜',
  'ë²„í„°ë¥˜',
  'ë²„í„°',
  'ê°€ê³µë²„í„°',
  'ì¹˜ì¦ˆë¥˜',
  'ì¹˜ì¦ˆ',
  'ê°€ê³µì¹˜ì¦ˆ',
  'ë¶„ìœ ë¥˜',
  'ìœ ì²­ë¥˜',
  'ìœ ë‹¹',
  'ìœ ë‹¨ë°±ê°€ìˆ˜ë¶„í•´ì‹í’ˆ',
  
  // ìˆ˜ì‚°ê°€ê³µì‹í’ˆë¥˜
  'ì–´ìœ¡ê°€ê³µí’ˆë¥˜',
  'ì–´ìœ¡ì‚´',
  'ì—°ìœ¡',
  'ì–´ìœ¡ë°˜ì œí’ˆ',
  'ì–´ë¬µ',
  'ì–´ìœ¡ì†Œì‹œì§€',
  'ê¸°íƒ€ì–´ìœ¡ê°€ê³µí’ˆ',
  'ì “ê°ˆë¥˜',
  'ê±´í¬ë¥˜',
  'ì¡°ë¯¸ê±´ì–´í¬',
  'ê±´ì–´í¬',
  'ê¸°íƒ€ê±´í¬ë¥˜',
  'ì—¼ê±´ê°•ì •',
  'ì—¼ê°•ì •',
  'í›ˆì œí’ˆ',
  'í˜¼í•©ì “ê°ˆ',
  'ì “ê°ˆ',
  'ì•¡ì “',
  'ì†ŒìŠ¤ì “ê°ˆ',
  'ë©¸ì¹˜ì•¡ì “',
  'ìƒˆìš°ì “',
  'ì¡°ë¯¸ê¹€',
  'ê¹€ìë°˜',
  'í•œì²œ',
  'ê¸°íƒ€ìˆ˜ì‚°ë¬¼ê°€ê³µí’ˆ',
  
  // ë™ë¬¼ì„±ê°€ê³µì‹í’ˆë¥˜
  'ê¸°íƒ€ì‹ìœ¡ë˜ëŠ”ê¸°íƒ€ì•Œì œí’ˆ',
  'ê³¤ì¶©ê°€ê³µì‹í’ˆ',
  'ë²ˆë°ê¸°í†µì¡°ë¦¼',
  'ìë¼ê°€ê³µì‹í’ˆ',
  'ì¶”ì¶œê°€ê³µì‹í’ˆ',
  
  // ë²Œê¿€ë°í™”ë¶„ê°€ê³µí’ˆë¥˜
  'ë²Œê¿€ë¥˜',
  'ë¡œì–„ì ¤ë¦¬ë¥˜',
  'í™”ë¶„ê°€ê³µì‹í’ˆ',
  
  // ì¦‰ì„ì‹í’ˆë¥˜
  'ìƒì‹ë¥˜',
  'ì¦‰ì„ì„­ì·¨Â·í¸ì˜ì‹í’ˆë¥˜',
  'ì¦‰ì„ì„­ì·¨ì‹í’ˆ',
  'ë„ì‹œë½',
  'ê¹€ë°¥ë¥˜',
  'í–„ë²„ê±°',
  'ìƒŒë“œìœ„ì¹˜ë¥˜',
  'ì¦‰ì„ì¡°ë¦¬ì‹í’ˆ',
  'ë°¥',
  'êµ­',
  'íƒ•',
  'ì°Œê°œ',
  'ì£½',
  'ìŠ¤í”„',
  'ë§Œë‘ë¥˜',
  'ë§Œë‘',
  
  // ê¸°íƒ€ì‹í’ˆë¥˜
  'íš¨ëª¨ì‹í’ˆ',
  'ê¸°íƒ€ê°€ê³µí’ˆ',
  
  // ì‹ìš©ë€
  'ì‹ìš©ë€',
  
  // ë‹­Â·ì˜¤ë¦¬ì˜ ì‹ìœ¡
  'ë‹­Â·ì˜¤ë¦¬ì˜ì‹ìœ¡',
  
  // ìì—°ìƒíƒœ ì‹í’ˆ
  'ìì—°ìƒíƒœì‹í’ˆ',
  
  // ì¶”ê°€ ì‹¤ìš©ì  í‚¤ì›Œë“œë“¤
  'ë¼ë©´',
  'ì»µë¼ë©´',
  'ë´‰ì§€ë¼ë©´',
  'ëƒ‰ë©´',
  'ëƒ‰ë™ë§Œë‘',
  'í”¼ì',
  'í–„ë²„ê±°',
  'ì¹˜í‚¨',
  'ë–¡ë³¶ì´',
  'ìˆœëŒ€',
  'ì–´ë¬µ',
  'ê¹€ë°¥',
  'ì´ˆë°¥',
  'ì°¸ì¹˜ìº”',
  'ê³ ë“±ì–´ìº”',
  'í† ë§ˆí† ì†ŒìŠ¤',
  'ë§ˆëŠ˜',
  'ì–‘íŒŒ',
  'ìƒê°•',
  'ê³ êµ¬ë§ˆ',
  'ê°ì',
  'ìŒ€',
  'í˜„ë¯¸',
  'ë³´ë¦¬',
  'ì½©',
  'íŒ¥',
  'ê²¬ê³¼ë¥˜',
  'í˜¸ë‘',
  'ì•„ëª¬ë“œ',
  'ì£'
];

async function uploadFoodTypes() {
  try {
    console.log('ğŸ“‹ ì‹í’ˆë“±ì˜ í‘œì‹œê¸°ì¤€ FOOD_TYPES ë°°ì—´ ì—…ë¡œë“œ ì‹œì‘...');
    console.log(`ì´ ${FOOD_TYPES.length}ê°œ ì‹í’ˆ ìœ í˜•`);
    
    // 1. ê¸°ì¡´ í‚¤ì›Œë“œë“¤ í™•ì¸
    const { data: existingKeywords, error: fetchError } = await supabase
      .from('search_keywords')
      .select('keyword');
    
    if (fetchError) {
      console.error('ê¸°ì¡´ í‚¤ì›Œë“œ ì¡°íšŒ ì˜¤ë¥˜:', fetchError);
      return;
    }
    
    const existingKeywordSet = new Set(existingKeywords.map(item => item.keyword));
    console.log(`ê¸°ì¡´ í‚¤ì›Œë“œ: ${existingKeywords.length}ê°œ`);
    
    // 2. ìƒˆë¡œ ì¶”ê°€í•  í‚¤ì›Œë“œ í•„í„°ë§
    const newKeywords = FOOD_TYPES
      .filter(keyword => !existingKeywordSet.has(keyword))
      .filter(keyword => keyword && keyword.trim().length > 0);
    
    console.log(`ìƒˆë¡œ ì¶”ê°€í•  í‚¤ì›Œë“œ: ${newKeywords.length}ê°œ`);
    
    if (newKeywords.length === 0) {
      console.log('ëª¨ë“  í‚¤ì›Œë“œê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.');
      return;
    }
    
    // 3. ìƒˆ í‚¤ì›Œë“œë“¤ì„ ë°°ì¹˜ë¡œ ì¶”ê°€
    let totalAdded = 0;
    
    for (const keyword of newKeywords) {
      try {
        // ìµœëŒ€ ID í™•ì¸
        const { data: maxData } = await supabase
          .from('search_keywords')
          .select('id')
          .order('id', { ascending: false })
          .limit(1)
          .maybeSingle();
        
        const nextId = (maxData?.id || 0) + 1;
        
        // í‚¤ì›Œë“œ ì‚½ì…
        const { error: insertError } = await supabase
          .from('search_keywords')
          .insert([{
            id: nextId,
            keyword: keyword,
            search_count: 0
          }]);
        
        if (insertError) {
          console.error(`âŒ "${keyword}" ì‚½ì… ì˜¤ë¥˜:`, insertError.message);
        } else {
          console.log(`âœ… "${keyword}" ì¶”ê°€ ì™„ë£Œ`);
          totalAdded++;
        }
        
        // API ì œí•œ ê³ ë ¤ ì ì‹œ ëŒ€ê¸°
        await new Promise(resolve => setTimeout(resolve, 50));
        
      } catch (err) {
        console.error(`âŒ "${keyword}" ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:`, err.message);
      }
    }
    
    console.log(`\nğŸ‰ ì´ ${totalAdded}ê°œ ìƒˆ í‚¤ì›Œë“œ ì¶”ê°€ ì™„ë£Œ!`);
    
    // 4. ì¦‰ì„ì¡°ë¦¬ì‹í’ˆ ê´€ë ¨ í™•ì¸
    const { data: instantKeywords } = await supabase
      .from('search_keywords')
      .select('keyword')
      .ilike('keyword', '%ì¦‰ì„%')
      .order('keyword');
    
    console.log('\nğŸ“‹ "ì¦‰ì„" ê´€ë ¨ í‚¤ì›Œë“œë“¤:');
    if (instantKeywords) {
      instantKeywords.forEach(item => console.log('- ' + item.keyword));
    }
    
    // 5. ìµœì¢… í‚¤ì›Œë“œ ìˆ˜ í™•ì¸
    const { count } = await supabase
      .from('search_keywords')
      .select('*', { count: 'exact', head: true });
    
    console.log(`\nğŸ“Š í˜„ì¬ ì´ í‚¤ì›Œë“œ: ${count}ê°œ`);
    
  } catch (error) {
    console.error('ğŸ’¥ ì˜¤ë¥˜ ë°œìƒ:', error);
  }
}

uploadFoodTypes();